schema: spec-driven

context: |
  Purpose: Personal AI assistant on Cloudflare Workers, accessed via Telegram.
  Helps with: emails, calendar, files, web search, scheduled tasks.
  Single-user only. Read-only email (forwarding). Human approval for risky ops.

  Tech stack: TypeScript (strict), Bun (local), Cloudflare Workers (prod)
  Framework: Hono (HTTP)
  LLM: Vercel AI SDK
  ORM: Drizzle ORM + D1
  Validation: Zod
  Telegram: Telegram Bot API (Webhook)
  CalDAV: tsdav
  Email: postal-mime
  IaC: OpenTofu
  Testing: Vitest
  Linting: Biome

  Conventions:
  - All source code in src/
  - Strict TypeScript
  - Zod schemas for all tool I/O validation
  - Drizzle ORM for all D1 access
  - Biome for lint/format
  - Vitest for tests

  Design principles:
  1. Least Privilege — minimum scope, human-in-the-loop for risky ops
  2. Cloudflare-Native — no VPS, use managed services
  3. Start Small + Extensible — Phase 1 Telegram only, abstracted adapters
  4. Auditable — log every LLM call and tool execution
  5. Human-Mediated — approval required for mutations

  Phased roadmap:
  Phase 1: Telegram adapter, agent loop, email, files, auth, audit
  Phase 2: Calendar (CalDAV), approval flow, scheduling, web search
  Phase 3: Long-term memory (Vectorize), Slack adapter, morning briefing

rules:
  specs:
    - Focus on observable behavior, not implementation details
    - Use Requirement/Scenario format with WHEN/THEN/AND keywords
  tasks:
    - Break tasks into small, independently testable units
    - Include Cloudflare Workers compatibility verification where relevant